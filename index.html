<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SuperBadger</title>
  <style>
    #container {
      position: relative;
      width: 512px;
    }

    button {
      position: absolute;
      margin-top: 75%;
      left: 50%;
      margin-left: -91px;
      padding:10px 60px;
      -webkit-border-radius: 25px;
      -moz-border-radius: 25px;
      border-radius: 25px;
      background: -webkit-gradient(linear, 0 0, 0 100%, from(#f6e6b4), to(#ed9017));
      background: -webkit-linear-gradient(#f6e6b4 0%, #ed9017 100%);
      background: -moz-linear-gradient(#f6e6b4 0%, #ed9017 100%);
      background: -o-linear-gradient(#f6e6b4 0%, #ed9017 100%);
      background: linear-gradient(#f6e6b4 0%, #ed9017 100%); /* firefox */
      border: solid #ccc 3px;
      box-shadow: 0 1px 2px #fff, 0 -1px 1px #666, inset 0 -1px 1px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.8);
      text-shadow: 0 1px 2px #fff;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="container">
    <button>Start&hellip;</button>
  </div>

  <script>
    (function() {

      // Create the canvas
      var canvas        = document.createElement("canvas"),
          context       = canvas.getContext("2d"),
          CANVAS_WIDTH  = 512,
          CANVAS_HEIGHT = 480,
          BADGER_WIDTH  = 60;
          BADGER_HEIGHT = 43;

      canvas.width = CANVAS_WIDTH;
      canvas.height = CANVAS_HEIGHT;
      document.body.appendChild(canvas);

      // Background image
      var bgReady = false,
          bgImage = new Image();
      bgImage.onload = function () {
        bgReady = true;
      };
      bgImage.src = "assets/playfield.jpg";

      // Badger image
      var badgerReady = false;
      var badgerImage = new Image();
      badgerImage.onload = function () {
        badgerReady = true;
      };
      badgerImage.src = "assets/badger.png";

      // Monster image
      var monsterReady = false;
      var monsterImage = new Image();
      monsterImage.onload = function () {
        monsterReady = true;
      };
      monsterImage.src = "assets/monster.png";

      // Game objects
      var badger = {
        speed: 256 // movement in pixels per second
      };
      var monster = {};
      var monstersCaught = 0;

      // Handle keyboard controls
      var keysDown = {};

      addEventListener("keydown", function (e) {
        keysDown[e.keyCode] = true;
      }, false);

      addEventListener("keyup", function (e) {
        delete keysDown[e.keyCode];
      }, false);

      // Reset the game when the player catches a monster
      var reset = function () {
        badger.x = canvas.width / 2;
        badger.y = canvas.height / 2;

        // Throw the monster somewhere on the screen randomly
        monster.x = 32 + (Math.random() * (canvas.width - 64));
        monster.y = 32 + (Math.random() * (canvas.height - 64));
      };

      // Update game objects
      var update = function (modifier) {

        if (38 in keysDown && badger.y > 0) { // UP
          badger.y -= badger.speed * modifier;
        }
        if (40 in keysDown && badger.y < CANVAS_HEIGHT - BADGER_HEIGHT) { // DOWN
          badger.y += badger.speed * modifier;
        }
        if (37 in keysDown && badger.x > 0) { // LEFT
          badger.x -= badger.speed * modifier;
        }
        if (39 in keysDown && badger.x < CANVAS_WIDTH - BADGER_WIDTH) { // RIGHT
          badger.x += badger.speed * modifier;
        }

        // Are they touching?
        if (
          badger.x <= (monster.x + 32)
          && monster.x <= (badger.x + 32)
          && badger.y <= (monster.y + 32)
          && monster.y <= (badger.y + 32)
        ) {
          ++monstersCaught;
          reset();
        }
      };

      // Draw everything
      var render = function () {
        if (bgReady) {
          var ptrn = context.createPattern(bgImage, "repeat");
          context.fillStyle = ptrn;
          context.fillRect(0, 0, canvas.width, canvas.height);
        }

        if (badgerReady) {
          context.drawImage(badgerImage, badger.x, badger.y);
        }

        if (monsterReady) {
          context.drawImage(monsterImage, monster.x, monster.y);
        }

        // Score
        context.fillStyle = "rgb(250, 250, 250)";
        context.font = "24px Helvetica";
        context.textAlign = "left";
        context.textBaseline = "top";
        context.fillText("" + monstersCaught, 32, 32);
      };

      // The main game loop
      var main = function () {
        var now = Date.now();
        var delta = now - then;

        update(delta / 1000);
        render();

        then = now;

        // Request to do this again ASAP
        requestAnimationFrame(main);
      };

      // Cross-browser support for requestAnimationFrame
      var w = window;
      requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame;

      // Let's play this game!
      var then = Date.now();
      reset();
      main();

      function init() {

      }

      init();
    })();
  </script>
</body>
</html>
